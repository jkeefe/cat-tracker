# Process Notes on Cat-Tracker

This is my log and rough note-taking spot of how I'm going about this project.

## Concept

I want to play with machine learning, and I have an idea to play with data generated by my cat's location in my home.

## Getting the Pi Running

This time I'm trying the pi-management site [Resin.io](http://resin.io) to get my code on my pi, espcially since I hope to have three of these working to take measurements.

Following the instructions here: https://docs.resin.io/raspberrypi3/nodejs/getting-started/#adding-your-first-device

- Started new project: `cattracker`
- Downloaded image
- Using Etcher to put image on an SD card
- Now booting up the Pi -- ooh, this showed up in mere minutes


Instead of using [the example repo](https://github.com/resin-io-projects/simple-server-node), I made my own new repo.

- Synched it to resin with: `git remote add resin [me]@git.resin.io:j_f_keefe/cattracker.git`
- Then did `npm init`
- Then added, based on the example repo, but changing `server.js` to `index.js`: 
```
"scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "start": "node index.js"
  },
```
- Copied `Dockerfile.template` from [here](https://github.com/resin-io-projects/simple-server-node/blob/master/Dockerfile.template)
- Loaded up my ssh key with `ssh-add`
- Did `git push origin master` to save a copy in my main repo
- Did `git push resin master` to send it to the pi
- WORKS: Saved as branch `git push --set-upstream origin waypoint1-sucessful-setup`

## Periodic updates with CRON

Going to check out [this example code](https://github.com/resin-io-playground/cron-example/blob/master/Dockerfile.template).


## Scanning for Beacons

Working roughly from this [explainer](https://blog.truthlabs.com/beacon-tracking-with-node-js-and-raspberry-pi-794afa880318) ...

- Installed "Bluez" on the Pi using info from [this site](https://www.thepolyglotdeveloper.com/2016/09/scan-bluetooth-enabled-ibeacons-via-raspberry-pi-iot-device/).
- Need to add `sudo apt-get install bluez bluez-hcidump` into the Docker startup file, I think.
- Doing that by altering the commented-out example in `Dockerfile.template` so it looks like this:
```bash
RUN apt-get update && apt-get install -yq \
    bluez bluez-hcidump && \
    apt-get clean && rm -rf /var/lib/apt/lists/*
```
- Eeeps, need more than that. Got **"Set scan parameters failed: File descriptor in bad state"** whenever I tried anything. So tried some of what is outlined [here](https://www.raspberrypi.org/forums/viewtopic.php?f=63&t=141850):

```shell
sudo apt-get purge bluez-utils blueman bluez bluez-firmware pi-bluetooth
sudo apt-get install blueman bluez  # RPi 2
sudo apt-get install blueman bluez bluez-firmware pi-bluetooth  # RPi 3
sudo usermod -G bluetooth -a pi  # Or it won't work
cat /etc/group | grep bluetooth
sudo service bluetooth status

# Reboot

# Test
sudo service bluetooth status
rfkill list
sudo hcitool lescan
bluetoothctl
```
Initially, I implemented this like so in the `Dockerfile.template`:

```bash
RUN apt-get update && apt-get install -yq \
    apt-get purge bluez-utils blueman bluez bluez-firmware pi-bluetooth \
    apt-get install blueman bluez bluez-firmware pi-bluetooth \
    apt-get clean && rm -rf /var/lib/apt/lists/*
```

- Going to try this in shell script instead:

```
usermod -G bluetooth -a pi \
cat /etc/group | grep bluetooth \
service bluetooth status \
```
